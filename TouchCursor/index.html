<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Wi-Fi Touchpad</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #0f1117;
  font-family: system-ui, sans-serif;
  touch-action: none;
}

#pad {
  width: 100%;
  height: 100%;
  display: grid;
  grid-template-rows: 1fr 80px;
}

#trackpad {
  background: radial-gradient(circle at center, #1a1d25, #0f1117);
}

#buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  background: #151821;
  border-top: 1px solid #222;
}

.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #bbb;
  font-size: 18px;
  user-select: none;
}

.btn:active {
  background: #222;
  color: #fff;
}
</style>
</head>

<body>
<div id="pad">
  <div id="trackpad"></div>
  <div id="buttons">
    <div class="btn" id="left">Left Click</div>
    <div class="btn" id="right">Right Click</div>
  </div>
</div>

<script>
const SERVER_IP = "192.168.68.56";
const ws = new WebSocket(`ws://${SERVER_IP}:8080`);

let lastX = 0;
let lastY = 0;
let mode = "move";

const sensitivity = 1.4;

const trackpad = document.getElementById("trackpad");
const leftBtn = document.getElementById("left");
const rightBtn = document.getElementById("right");

// Touch start
trackpad.addEventListener("touchstart", e => {
  const t = e.touches[0];
  lastX = t.clientX;
  lastY = t.clientY;

  // Two-finger = scroll
  mode = e.touches.length === 2 ? "scroll" : "move";
});

// Touch move
trackpad.addEventListener("touchmove", e => {
  e.preventDefault();

  const t = e.touches[0];
  const dx = (t.clientX - lastX) * sensitivity;
  const dy = (t.clientY - lastY) * sensitivity;

  if (mode === "move") {
    ws.send(JSON.stringify({
      type: "move",
      dx,
      dy
    }));
  } else {
    ws.send(JSON.stringify({
      type: "scroll",
      dy: Math.sign(dy) * 4
    }));
  }

  lastX = t.clientX;
  lastY = t.clientY;
}, { passive: false });

// Buttons
leftBtn.addEventListener("touchstart", () => {
  ws.send(JSON.stringify({ type: "click", button: "left" }));
});

rightBtn.addEventListener("touchstart", () => {
  ws.send(JSON.stringify({ type: "click", button: "right" }));
});

// Fullscreen on tap (mobile browsers)
document.body.addEventListener("click", () => {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen().catch(()=>{});
  }
}, { once: true });
</script>
</body>
</html>
