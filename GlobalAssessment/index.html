<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pacific Digital Evolution Timeline</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(180deg, #0a0a0a, #1a1a1a);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
        color: #eee;
        height: 100vh;
      }

      .container {
        max-width: 100%;
        padding: 20px;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        text-align: center;
        padding: 20px 0;
        z-index: 10;
        position: relative;
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        background: linear-gradient(to right, #00c2ff, #007bff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        font-size: 1.2rem;
        color: #aaa;
        max-width: 800px;
        margin: 0 auto;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
      }

      .control-btn {
        background: rgba(20, 20, 20, 0.7);
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: bold;
        color: #00c2ff;
        border: 2px solid #00c2ff;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .control-btn:hover {
        background: rgba(0, 194, 255, 0.2);
        box-shadow: 0 0 15px rgba(0, 194, 255, 0.5);
      }

      .zoom-display {
        color: #00c2ff;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .timeline-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
        perspective: 1000px;
        margin-top: 20px;
      }

      .bg-stars {
        position: absolute;
        top: 0;
        left: 0;
        width: 300%;
        height: 100%;
        background: url("https://www.transparenttextures.com/patterns/stardust.png");
        background-size: 400px;
        opacity: 0.25;
        z-index: 0;
        will-change: transform;
      }

      .timeline-line {
        position: absolute;
        top: 50%;
        left: 0;
        height: 8px;
        width: 100%;
        background: rgba(255, 255, 255, 0.15);
        z-index: 1;
        overflow: hidden;
      }

      .timeline-progress {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #00c2ff, #007bff);
        box-shadow: 0 0 12px rgba(0, 194, 255, 0.7);
        transition: width 0.1s linear;
      }

      .timeline-container {
        display: flex;
        align-items: center;
        height: 100%;
        padding: 0 100px;
        position: relative;
        will-change: transform;
        z-index: 2;
        transition: transform 0.5s ease;
      }

      .event {
        position: relative;
        flex: 0 0 600px;
        margin: 0 80px;
        text-align: center;
        transition: transform 0.5s ease, opacity 0.5s ease;
        opacity: 0.7;
        transform: scale(0.9);
      }

      .event.focused {
        opacity: 1;
        transform: scale(1.08) translateY(-10px);
        z-index: 10;
      }

      .event-icon {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(145deg, #007bff, #0056b3);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        position: relative;
        z-index: 2;
        font-size: 44px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        transition: all 0.3s ease;
        border: 3px solid rgba(255, 255, 255, 0.1);
      }

      .event.focused .event-icon {
        transform: rotate(10deg) scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 123, 255, 0.6);
      }

      .event-period {
        font-weight: bold;
        color: #00c2ff;
        margin-top: 15px;
        position: relative;
        z-index: 2;
        font-size: 22px;
        text-shadow: 0 0 8px rgba(0, 194, 255, 0.6);
      }

      .event-card {
        background: rgba(20, 20, 20, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        width: 450px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        font-size: 16px;
        line-height: 1.5;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        opacity: 0;
        visibility: hidden;
        z-index: 20;
      }

      .event.focused .event-card {
        opacity: 1;
        visibility: visible;
      }

      .event:nth-child(odd) .event-card {
        top: 160px;
      }

      .event:nth-child(even) .event-card {
        bottom: 160px;
      }

      .event-title {
        font-size: 18px;
        color: #00c2ff;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .event-description {
        font-size: 15px;
        color: #ddd;
        margin-bottom: 8px;
      }

      .event-legal {
        font-size: 13px;
        color: #aaa;
        font-style: italic;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 8px;
        margin-top: 8px;
      }

      .event-reference {
        display: block;
        margin-top: 10px;
        color: #00c2ff;
        text-decoration: none;
        font-size: 14px;
      }

      .event-reference:hover {
        text-decoration: underline;
      }

      .scroll-hint {
        text-align: center;
        margin-top: 20px;
        color: #00c2ff;
        font-style: italic;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      .island-selector {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 20px 0;
      }

      .island-btn {
        background: rgba(20, 20, 20, 0.7);
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: bold;
        color: #00c2ff;
        border: 2px solid #00c2ff;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .island-btn.active {
        background: rgba(0, 194, 255, 0.2);
        box-shadow: 0 0 15px rgba(0, 194, 255, 0.5);
      }

      .timeline-scroll-container {
        width: 100%;
        height: 100%;
        overflow: auto;
        position: relative;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .timeline-scroll-container::-webkit-scrollbar {
        display: none;
      }

      .loading {
        text-align: center;
        color: #00c2ff;
        font-size: 1.2rem;
        margin-top: 50px;
      }

      @media (max-width: 1200px) {
        .timeline-container {
          padding: 0 80px;
        }

        .event {
          flex: 0 0 550px;
          margin: 0 60px;
        }

        .event-card {
          width: 400px;
        }
      }

      @media (max-width: 768px) {
        .timeline-container {
          padding: 0 40px;
        }

        .event {
          flex: 0 0 400px;
          margin: 0 40px;
        }

        .event-card {
          width: 320px;
          padding: 15px;
        }

        .event:nth-child(odd) .event-card,
        .event:nth-child(even) .event-card {
          position: fixed;
          bottom: 20px;
          top: auto;
          left: 50%;
          transform: translateX(-50%);
          width: 90%;
          max-width: 320px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Pacific Digital Evolution Timeline</h1>
        <p class="subtitle">
          From colonial administration to digital transformation in the Cook
          Islands, Niue, and Tokelau
        </p>
      </header>

      <div class="island-selector">
        <div class="island-btn active" data-island="all">All Islands</div>
        <div class="island-btn" data-island="cook">Cook Islands</div>
        <div class="island-btn" data-island="niue">Niue</div>
        <div class="island-btn" data-island="tokelau">Tokelau</div>
      </div>

      <div class="scroll-hint">
        <i class="fas fa-arrows-left-right"></i> Scroll horizontally to navigate
        the timeline
      </div>

      <div class="timeline-wrapper">
        <div class="bg-stars" id="bg"></div>
        <div class="timeline-line">
          <div class="timeline-progress" id="progress"></div>
        </div>
        <div class="timeline-scroll-container" id="scroll-container">
          <div class="timeline-container" id="timeline">
            <div class="loading">Loading timeline data...</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let timelineData = [];

      fetch("data.json")
        .then((response) => response.json())
        .then((data) => {
          timelineData = data.timelineData;
          console.log(timelineData);
          initTimeline();
        })
        .catch((error) => {
          console.error("Error loading timeline data:", error);
          timeline.innerHTML =
            '<div class="loading">Error loading timeline data. Please try again later.</div>';
        });

      // DOM elements
      const timeline = document.getElementById("timeline");
      const scrollContainer = document.getElementById("scroll-container");
      const bg = document.getElementById("bg");
      const progress = document.getElementById("progress");
      const islandBtns = document.querySelectorAll(".island-btn");
      const zoomInBtn = document.getElementById("zoom-in");
      const zoomOutBtn = document.getElementById("zoom-out");
      const zoomLevelDisplay = document.getElementById("zoom-level");

      // Variables
      let events = [];
      let scrollX = 0;
      let velocity = 0;
      let isDragging = false;
      let startX = 0;
      let currentIsland = "all";
      let focusedEventIndex = -1;
      let zoomLevel = 1.0;
      let rafId = null;
      let lastScrollTime = 0;

      // Initialize the timeline
      function initTimeline() {
        // Clear loading message
        timeline.innerHTML = "";

        // Create event elements from data
        timelineData.forEach((eventData) => {
          const eventElement = document.createElement("div");
          eventElement.className = "event";
          eventElement.setAttribute(
            "data-islands",
            eventData.islands.join(" ")
          );

          eventElement.innerHTML = `
                    <div class="event-icon">${eventData.icon}</div>
                    <div class="event-period">${eventData.period}</div>
                    <div class="event-card">
                        <div class="event-title">${eventData.title}</div>
                        <p class="event-description">${eventData.description}</p>
                        <p class="event-legal">${eventData.legal}</p>
                        <a href="${eventData.reference}" target="_blank" class="event-reference">
                            <i class="fas fa-external-link-alt"></i> Reference
                        </a>
                    </div>
                `;

          timeline.appendChild(eventElement);
        });

        // Update events list
        events = document.querySelectorAll(".event");

        // Initialize the rest of the functionality
        setupEventListeners();
        filterEvents("all");
        updateZoom();
        setupNativeScrolling();
      }

      // Setup event listeners
      function setupEventListeners() {
        // Island filter buttons
        islandBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            islandBtns.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            filterEvents(this.getAttribute("data-island"));
          });
        });

        // Mouse wheel scrolling with momentum
        scrollContainer.addEventListener(
          "wheel",
          (e) => {
            e.preventDefault();
            // Add momentum-based scrolling
            velocity += e.deltaY * 1.2;

            // If we're not already animating, start
            if (!rafId && Math.abs(velocity) > 1) {
              lastScrollTime = 0;
              rafId = requestAnimationFrame(animate);
            }
          },
          { passive: false }
        );

        // Touch events for mobile
        scrollContainer.addEventListener("touchstart", (e) => {
          isDragging = true;
          startX = e.touches[0].clientX - scrollX;
          velocity = 0;
        });

        scrollContainer.addEventListener("touchmove", (e) => {
          if (!isDragging) return;
          e.preventDefault();
          const x = e.touches[0].clientX;
          scrollX = x - startX;
          scrollContainer.scrollLeft = scrollX;
        });

        scrollContainer.addEventListener("touchend", () => {
          isDragging = false;
          // Continue momentum after release
          if (Math.abs(velocity) > 1) {
            lastScrollTime = 0;
            rafId = requestAnimationFrame(animate);
          }
        });

        // Mouse drag for desktop
        scrollContainer.addEventListener("mousedown", (e) => {
          isDragging = true;
          startX = e.clientX - scrollX;
          velocity = 0;
          scrollContainer.style.cursor = "grabbing";
        });

        window.addEventListener("mousemove", (e) => {
          if (!isDragging) return;
          const x = e.clientX;
          scrollX = x - startX;
          scrollContainer.scrollLeft = scrollX;
        });

        window.addEventListener("mouseup", () => {
          isDragging = false;
          scrollContainer.style.cursor = "grab";
          // Continue momentum after release
          if (Math.abs(velocity) > 1) {
            lastScrollTime = 0;
            rafId = requestAnimationFrame(animate);
          }
        });

        // Handle window resize
        window.addEventListener("resize", () => {
          updateEventFocus();
        });
      }

      function updateEventFocus() {
        const timelineRect = timeline.getBoundingClientRect();
        const timelineCenter = window.innerWidth / 2;

        events.forEach((event, index) => {
          if (event.style.display === "none") return;

          const eventRect = event.getBoundingClientRect();
          const eventCenter = eventRect.left + eventRect.width / 2;

          // Calculate distance from center
          const distance = Math.abs(timelineCenter - eventCenter);

          if (distance < eventRect.width / 2) {
            event.classList.add("focused");
            focusedEventIndex = index;
          } else {
            event.classList.remove("focused");
          }
        });
      }

      function filterEvents(island) {
        currentIsland = island;

        events.forEach((event) => {
          const eventIslands = event.getAttribute("data-islands").split(" ");

          if (island === "all" || eventIslands.includes(island)) {
            event.style.display = "flex";
          } else {
            event.style.display = "none";
            event.classList.remove("focused");
          }
        });

        // Reset scroll position after filtering
        scrollContainer.scrollLeft = 0;
        scrollX = 0;
        velocity = 0;
        updateZoom();
      }

      function updateZoom() {
        // Adjust event spacing based on zoom level
        events.forEach((event) => {
          if (event.style.display !== "none") {
            // Increase spacing with zoom level
            const spacing = 80 * zoomLevel;
            event.style.margin = `0 ${spacing}px`;

            // Scale event size
            const scale = 1 / zoomLevel;
            event.style.transform = `scale(${scale})`;

            if (event.classList.contains("focused")) {
              event.style.transform = `scale(${
                scale * 1.08
              }) translateY(-10px)`;
            }
          }
        });

        // Update zoom level display

        // Adjust timeline container scale
        timeline.style.transform = `scale(${1 / zoomLevel})`;
        timeline.style.transformOrigin = "0 50%";
      }

      function animate(timestamp) {
        if (!lastScrollTime) lastScrollTime = timestamp;
        const elapsed = timestamp - lastScrollTime;

        // Only update at 60fps for smoother animation
        if (elapsed > 16) {
          // Apply velocity
          scrollX += velocity;

          // Apply friction
          velocity *= 0.87;

          // Stop animation if velocity is very small
          if (Math.abs(velocity) < 0.1) {
            velocity = 0;
          }

          const maxScroll =
            timeline.scrollWidth * zoomLevel - window.innerWidth;

          // Bounce back when beyond boundaries
          if (scrollX < -300) {
            scrollX = -300;
            velocity = -velocity * 0.5;
          } else if (scrollX > maxScroll + 300) {
            scrollX = maxScroll + 300;
            velocity = -velocity * 0.5;
          }

          // Apply gentle pull when beyond normal boundaries
          if (scrollX < 0) {
            velocity += -scrollX * 0.15;
          } else if (scrollX > maxScroll) {
            velocity += (maxScroll - scrollX) * 0.15;
          }

          // Update visuals
          scrollContainer.scrollLeft = scrollX;
          bg.style.transform = `translateX(${-scrollX * 0.3}px)`;

          // Update progress bar (clamped between 0 and 100%)
          const clampedScroll = Math.min(Math.max(scrollX, 0), maxScroll);
          const progressPercent = (clampedScroll / maxScroll) * 100;
          progress.style.width = `${progressPercent}%`;

          // Update which event is focused
          updateEventFocus();

          lastScrollTime = timestamp;
        }

        rafId = requestAnimationFrame(animate);
      }

      // Use native scrolling for a more natural feel
      function setupNativeScrolling() {
        scrollContainer.addEventListener("scroll", (e) => {
          scrollX = scrollContainer.scrollLeft;
          updateEventFocus();

          const maxScroll =
            timeline.scrollWidth * zoomLevel - window.innerWidth;
          const progressPercent = (scrollX / maxScroll) * 100;
          progress.style.width = `${progressPercent}%`;

          bg.style.transform = `translateX(${-scrollX * 0.3}px)`;
        });

        // Cancel the custom animation
        if (rafId) {
          cancelAnimationFrame(rafId);
          rafId = null;
        }
      }

      // Initialize the timeline
      initTimeline();
    </script>
  </body>
</html>
